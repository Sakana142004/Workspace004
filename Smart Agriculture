<!DOCTYPE html>
<html>
    <head>
        <title>Login Future Agri</title>
       <link rel="stylesheet" href="background.css">
       <link rel="stylesheet" href="login-css.css">
       <link rel="stylesheet" href="signup.css">
       <script src="showPass.js"></script>
    </head>
    <body>
        <div class="background">
            <div class="login">
                    <div class="login-text">
                        Login here !
                    </div>
                    <div>
                      <input class="mail" type="text" placeholder="Email or Phone" name="user-id">
                    </div>
                    <div>
                      <input class="pwd" type="password" name="password" placeholder="Password" id="typepass1">
                    </div>
                    <div class= "show-pass">
                        <label for="show1">Show password</label>
                        <input type="checkbox" id="show1" onclick="Toggle1()"></div>
                    <div>
                      <input class="login-send" type="submit" value="Login" id='login'>
                    </div>
          </div>
          <div class="sign-up">
                <div class="signup-text">
                    Sign Up here !
                </div>
                <div>
                  <input class="username" type="text" placeholder="User Name" name="user-id" id="username">
                </div>
                <div>
                  <input class="mail" class="phone" type="text" type="digits" placeholder="Email or Phone" name="user-id" id="emailId" id="phoneNo">
                </div>
                <div>
                  <input class="pwd" type="password" name="password" placeholder="Create Password" id="typepass">
                </div>
                <div>
                    <input class="pwd" type="password" name="password" placeholder="Re-Enter Password" id="typepass3">
                  </div>
                <div class= "show-pass">
                    <label for="show">Show password</label>
                    <input type="checkbox" id="show" onclick="Toggle2()"></div>
                <div>
                  <input class="signup-send" type="submit" value="SignUp" id='signUp'>
                </div>
      </div>
      <div class="next-page">
          <a href="http://127.0.0.1:5500/page2/UserInputUpdated.html">Next Page ></a> 
      </div>
        </div>
    </body>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";
      import { getDatabase,set ,ref,update} from "https://www.gstatic.com/firebasejs/9.13.0/firebase-database.js";
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,onAuthStateChanged} from "https://www.gstatic.com/firebasejs/9.13.0/firebase-auth.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyC-puPCMYcosc_jbvtjdwsMV8eGPthfu4g",
        authDomain: "farmer-login-d4dc7.firebaseapp.com",
        databaseURL: "https://farmer-login-d4dc7-default-rtdb.firebaseio.com",
        projectId: "farmer-login-d4dc7",
        storageBucket: "farmer-login-d4dc7.appspot.com",
        messagingSenderId: "164821840203",
        appId: "1:164821840203:web:cbd51900f16540a738f8ce"
      };
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);  
      const auth = getAuth();
      signUp.addEventListener('click',(e)=> {
      var email = document.getElementById('emailId').value;
      var password = document.getElementById('typepass').value;
      var username = document.getElementById('username').value;
      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          // Signed in 
          const user = userCredential.user;
          set(ref(database,'users/'+user.uid),{
            username : username,
            email : email
          })
          alert('user Created');
          // ...
        })
        .catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;

          alert(errorMessage);
    // ..
   });  
});
login.addEventListener('click',(e)=> {
  var email = document.getElementById('emailId').value;
  var password = document.getElementById('typepass').value;

  signInWithEmailAndPassword(auth, email, password)
  .then((userCredential) => {
    // Signed in 
    const user = userCredential.user;
    const dt = new Date();
    update(ref(database,'users/'+user.uid),{
            last_login : dt,
          })
      alert('User loged in');
    // ...
  })
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;
    alert(errorMessage);

  });
    });
  const user = auth.currentUser;
onAuthStateChanged(auth, (user) => {
  if (user) {
    const uid = user.uid;
    document.getElementById("next-page").disabled = true;
  } else {
    document.getElementById("next-page").disabled = false;
  }
});
    </script>
</html>



